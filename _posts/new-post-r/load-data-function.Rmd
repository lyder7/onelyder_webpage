---
title: "Laste inn mye data"
description: |
  Hvordan lage en funksjon som kan laste inn mye data? Fra filer i alle formater; xlsx, csv, txt ... etc. Exel ark har ofte flere "sheets", laste inn alle med en gang? 
author:
  - name: Lyder Aleksander Mathisen
    url: https://onelyder.com
date: "`r Sys.Date()`"
output: distill::distill_article
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rio)
library(here)
library(fs)
library(openxlsx)
library(tidyxl)
library(readxl)
```

# Data

Planen er å lage en funksjon som laster inn data som blir tilgjenglig.
Excel ark, csv filer og tekst er vanlig.

Få inn all data.

```{r}
list_data <- list.files("data/additional_data/", pattern = "*.xlsx")
list_sheets <- paste0("sheet_", seq(1, length(list_data)))
```

# Kjøreregler i R

Anbefalte valg av paramtere:

`i`, `j` indikerer rad og kolonne

`n` lengde

`p` antall kolonner

## Excel i R

La oss gå litt dypere inn i hva vi har av funksjoner tilgienglig spesiellt laget for Excel.

```{r}
#Sys.glob("data/additional_data/", grepl = "*.xlsx")
f <- pacman::p_functions("tidyxl")
ff <- pacman::p_functions("openxlsx")
fff <- pacman::p_functions("purrr")
```

Som vi allerede har diskutert er det flere fordeler med å bruke tidyverse pakkene, og derav spessielt dplyr, tidyr og purrr.
I purrr får vi tilgang til map, walk, pmap og andre loop funksjoner, som hjelper oss mye!!

## Shiny, Tidyverse & onelyder

La oss bare hoppe rett i det. Vi bygger for alle tre.

```{r stackoverflow}
read_all_sheets = function(xlsxFile, ...) {
  sheet_names = openxlsx::getSheetNames(xlsxFile)
  sheet_list = as.list(rep(NA, length(sheet_names)))
  names(sheet_list) = sheet_names
  for (sn in sheet_names) {
    sheet_list[[sn]] = openxlsx::read.xlsx(xlsxFile, sheet=sn, ...)
  }
  return(sheet_list)
}

```
